plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

group 'org.itxtech'
version '2.1.2'
description '模块化、轻量级且支持完全自定义的 mirai 加载器。'

repositories {
    mavenCentral()
}

dependencies {
    implementation('commons-cli:commons-cli:1.5.0')
    implementation('com.google.code.gson:gson:2.10')
    implementation('org.fusesource.jansi:jansi:2.4.0')
    implementation('org.ow2.asm:asm:9.7')
}

def getGitHash = { ->
    return 'nlr-patched'
}

shadowJar {
    manifest {
        attributes "Main-Class": "org.itxtech.mcl.Loader"
        attributes "Version": project.version + "-" + getGitHash()
        attributes "Launcher-Agent-Class": "org.itxtech.mcl.Agent"
        attributes "Agent-Class": "org.itxtech.mcl.Agent"
        attributes "Premain-Class": "org.itxtech.mcl.Agent"
    }

    exclude("META-INF/LICENSE.txt", "META-INF/NOTICE.txt", "META-INF/NOTICE-tools.txt")

    minimize()
}

assemble.dependsOn(shadowJar)

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

tasks.withType(JavaCompile).configureEach {
    options.encoding = 'UTF-8'
}
